# move systemdunitdir somewhere user-writable during distcheck
AM_DISTCHECK_CONFIGURE_FLAGS = \
	--with-systemdunitdir='$${prefix}/lib/systemd/system' \
	$(NULL)

SUBDIRS = gnome-initial-setup gnome-software

if BUILD_ICONTHEME
SUBDIRS += icons
endif

if BUILD_FONTS
SUBDIRS += fonts
endif

if BUILD_SETTINGS
SUBDIRS += safe-defaults settings
endif

if BUILD_FACES
SUBDIRS += faces
endif

EXTRA_DIST = \
	autogen.sh \
	$(NULL)

MAINTAINERCLEANFILES =			\
	Makefile.in			\
	aclocal.m4			\
	config.guess			\
	config.h.in			\
	config.sub			\
	configure			\
	depcomp				\
	install-sh			\
	intltool-*.in			\
	libtool				\
	ltmain.sh			\
	missing				\
	mkinstalldirs

dist-hook:
	if test -d "$(srcdir)/.git"; \
	then \
		echo Creating ChangeLog && \
		( cd "$(top_srcdir)" && \
		  echo '# Generated by Makefile. Do not edit.'; echo; \
		  $(top_srcdir)/missing --run git log --stat ) > ChangeLog.tmp \
		&& mv -f ChangeLog.tmp $(top_distdir)/ChangeLog \
		|| ( rm -f ChangeLog.tmp ; \
		     echo Failed to generate ChangeLog >&2 ); \
		else \
		echo A git clone is required to generate a ChangeLog >&2; \
	fi
